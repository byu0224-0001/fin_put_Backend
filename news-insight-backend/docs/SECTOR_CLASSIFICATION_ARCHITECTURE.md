# ì„¹í„° ë¶„ë¥˜ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ë¬¸ì„œ

## ğŸ“‹ ëª©ì°¨
1. [ì „ì²´ ê°œìš”](#ì „ì²´-ê°œìš”)
2. [ì‹œìŠ¤í…œ êµ¬ì¡°ë„](#ì‹œìŠ¤í…œ-êµ¬ì¡°ë„)
3. [ë‹¨ê³„ë³„ ìƒì„¸ ì„¤ëª…](#ë‹¨ê³„ë³„-ìƒì„¸-ì„¤ëª…)
4. [ë°ì´í„° íë¦„](#ë°ì´í„°-íë¦„)
5. [Fallback ë©”ì»¤ë‹ˆì¦˜](#fallback-ë©”ì»¤ë‹ˆì¦˜)
6. [Boosting ì‹œìŠ¤í…œ](#boosting-ì‹œìŠ¤í…œ)
7. [Confidence ë ˆë²¨](#confidence-ë ˆë²¨)

---

## ì „ì²´ ê°œìš”

### í•µì‹¬ ì§„ì…ì 
- **ë©”ì¸ í•¨ìˆ˜**: `classify_sector_ensemble_won()` (`sector_classifier_ensemble_won.py`)
- **ê¸°ë°˜ í•¨ìˆ˜**: `classify_sector_ensemble()` (`sector_classifier_ensemble.py`)

### ì „ì²´ íŒŒì´í”„ë¼ì¸
```
Step 0-3.5: ê¸°ì¡´ Ensemble ë°©ì‹
  â†“
Step 4A: KF-DeBERTa Driver Signal Extraction
  â†“
Step 4B: Gemini-Reasoning Industrial Graph
  â†“
Step 4.5: Exposure Drivers ì¶”ì¶œ
  â†“
ìµœì¢… ê²°ê³¼ ë°˜í™˜
```

---

## ì‹œìŠ¤í…œ êµ¬ì¡°ë„

### Level 1: ì „ì²´ íŒŒì´í”„ë¼ì¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              classify_sector_ensemble_won()                   â”‚
â”‚                    (ë©”ì¸ ì§„ì…ì )                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                             â”‚
        â–¼                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 0-3.5      â”‚         â”‚  Step 0.0        â”‚
â”‚  Ensemble        â”‚         â”‚  SPAC ì²´í¬        â”‚
â”‚  (ê¸°ì¡´ ë°©ì‹)      â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 0.5        â”‚
â”‚  ì§€ì£¼ì‚¬ ë¶„ë¥˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 0.6        â”‚
â”‚  ë¦¬ì¸  ë¶„ë¥˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 0.7        â”‚
â”‚  Primary ê²°ì •     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 0.8        â”‚
â”‚  L2 ë¶„ë¦¬         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 4A         â”‚
â”‚  Driver Signal   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 4B         â”‚
â”‚  Gemini Reasoningâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 4.5        â”‚
â”‚  Exposure Driversâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ìµœì¢… ê²°ê³¼ ë°˜í™˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Level 2: Step 0-3.5 ìƒì„¸ (classify_sector_ensemble)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              classify_sector_ensemble()                      â”‚
â”‚              (ê¸°ì¡´ Ensemble ë°©ì‹)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                             â”‚
        â–¼                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 0          â”‚         â”‚  CompanyDetail   â”‚
â”‚  KRX ì—…ì¢… Prior  â”‚         â”‚  ì¡°íšŒ             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 1          â”‚
â”‚  Rule-based      â”‚
â”‚  (ê°€ì¤‘ì¹˜ 40%)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€ HIGH confidence? â”€â”€ YES â”€â”€â–º ì¦‰ì‹œ ë°˜í™˜
         â”‚
         NO
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 2          â”‚
â”‚  ì„ë² ë”© ëª¨ë¸      â”‚
â”‚  (ê°€ì¤‘ì¹˜ 30%)    â”‚
â”‚  Solar Embedding â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 2.5        â”‚
â”‚  Anchor Boosting â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 2.6        â”‚
â”‚  KG Edge Boostingâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 3          â”‚
â”‚  BGE-M3 ì œê±°     â”‚
â”‚  (Solar í†µí•©)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 3.5        â”‚
â”‚  Sub-sector ë¶„ë¥˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 4          â”‚
â”‚  GPT ê²€ì¦        â”‚
â”‚  (ì„ íƒì )        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Fallback ì²´í¬    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ìµœì¢… ê²°ê³¼ ë°˜í™˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ë‹¨ê³„ë³„ ìƒì„¸ ì„¤ëª…

### Step 0: KRX ì—…ì¢… Prior
- **ëª©ì **: KRX ê³µì‹œ ì—…ì¢… ì •ë³´ë¥¼ Priorë¡œ í™œìš©
- **í•¨ìˆ˜**: `classify_sector_step1_krx()`
- **ì¶œë ¥**: `(krx_major, krx_sub, krx_confidence)`
- **í™œìš©**:
  - Step 1 Rule-based ê²°ê³¼ì™€ ë¹„êµ
  - ì¼ì¹˜ ì‹œ Confidence ë³´ë„ˆìŠ¤ (+0.1)
  - ë¶ˆì¼ì¹˜ ì‹œ í›„ë³´ì— ì¶”ê°€

### Step 1: Rule-based Classification
- **ê°€ì¤‘ì¹˜**: 40%
- **í•¨ìˆ˜**: `classify_sector_rule_based()`
- **ì…ë ¥**: `CompanyDetail`, `company_name`
- **ì¶œë ¥**: `(rule_major, rule_sub, rule_vc, rule_conf)`
- **ì ìˆ˜ ë§¤í•‘**:
  - HIGH â†’ 1.0
  - MEDIUM â†’ 0.7
  - LOW â†’ 0.4
- **ì¡°ê¸° ì¢…ë£Œ ì¡°ê±´**: `rule_conf == "HIGH" and rule_score >= 0.9`

### Step 2: ì„ë² ë”© ëª¨ë¸ í›„ë³´ ìƒì„±
- **ê°€ì¤‘ì¹˜**: 30% (Solar Embeddingìœ¼ë¡œ í†µí•©)
- **ëª¨ë¸**: Solar Embedding (4,000 í† í° ì§€ì›)
- **í•¨ìˆ˜**: `generate_sector_candidates()`
- **ì…ë ¥**: `company_text` (ì „ì²´ í…ìŠ¤íŠ¸)
- **ì¶œë ¥**: Top-5 í›„ë³´ ì„¹í„° ë¦¬ìŠ¤íŠ¸
- **ì„ê³„ê°’**: `min_threshold=0.3`

### Step 2.5: Anchor Boosting
- **ì „ëµ**: Budget ìƒíƒœ ê´€ë¦¬ ë°©ì‹
- **í•¨ìˆ˜**: `apply_anchor_boosting()`
- **ì¡°ê±´**:
  - ë²”ìš© ì„¹í„° ì™„ì „ ê¸ˆì§€
  - Role Gate ê°ì‡  ì ìš©
  - Top-2 gap < 0.03
  - Budget ì²´í¬
- **Budget**: `MAX_TOTAL_BOOST = 0.05`

### Step 2.6: KG Edge Boosting
- **ì „ëµ**: ì•ˆì „í•œ Edge íƒ€ì…ë§Œ ì‚¬ìš©
- **í•¨ìˆ˜**: `apply_kg_edge_boosting()`
- **ì¡°ê±´**:
  - ë²”ìš© ì„¹í„° ì™„ì „ ê¸ˆì§€
  - Role Gate ê°ì‡  ì ìš© (Anchorì—ì„œ ê³„ì‚°ëœ multiplier ì¬ì‚¬ìš©)
  - Top-2 gap < 0.03
  - Budget ì²´í¬
- **Edge íƒ€ì…ë³„ ê°€ì¤‘ì¹˜ ì°¨ë“±**

### Step 3: BGE-M3 Re-ranking
- **ìƒíƒœ**: ì œê±°ë¨ (Solar Embeddingìœ¼ë¡œ í†µí•©)
- **ì´ìœ **: Solar Embeddingì´ ì¶©ë¶„íˆ ì •í™•í•˜ë¯€ë¡œ Re-ranking ë¶ˆí•„ìš”
- **ëŒ€ì²´**: Step 2 ê²°ê³¼ì—ì„œ Top-2 ì§ì ‘ ì„ íƒ

### Step 3.5: Sub-sector ë¶„ë¥˜
- **í•¨ìˆ˜**: `classify_sub_sector()`
- **ë°©ì‹**: ê·œì¹™ ê¸°ë°˜
- **ì…ë ¥**: `major_sector`, `company_detail`
- **ì¶œë ¥**: `sub_sector` ì½”ë“œ

### Step 4: GPT ìµœì¢… ê²€ì¦
- **ê°€ì¤‘ì¹˜**: 10% (ì„ íƒì )
- **í•¨ìˆ˜**: `validate_sectors_with_gpt()`
- **ì…ë ¥**: Top-2 í›„ë³´ ì„¹í„°
- **ì¶œë ¥**: ê²€ì¦ëœ ì„¹í„° ë¦¬ìŠ¤íŠ¸
- **ë¹„ê³ **: `use_gpt=False` ì‹œ ìŠ¤í‚µ

### Step 0.5: ì§€ì£¼ì‚¬ ìë™ ë¶„ë¥˜
- **í•¨ìˆ˜**: `classify_holding_with_multi_sector()`
- **ì¡°ê±´**: ì§€ì£¼ì‚¬ í‚¤ì›Œë“œ ê°ì§€
- **ì¶œë ¥**: `SEC_HOLDING` ì„¹í„° ì¶”ê°€ (Multi-sector ì§€ì›)

### Step 0.6: ë¦¬ì¸ (REITs) ìë™ ë¶„ë¥˜
- **í•¨ìˆ˜**: `classify_reit_with_multi_sector()`
- **ì¡°ê±´**: ë¦¬ì¸  í‚¤ì›Œë“œ ê°ì§€
- **ì¶œë ¥**: `SEC_REIT` ì„¹í„° ì¶”ê°€ (Multi-sector ì§€ì›)

### Step 0.7: Primary ì„¹í„° ê²°ì •
- **í•¨ìˆ˜**: `apply_primary_sector_flags()`
- **ëª©ì **: Multi-sector ì¼€ì´ìŠ¤ì—ì„œ Primary ì„¹í„° ê²°ì •
- **ê¸°ì¤€**: `sector_weight`ê°€ ê°€ì¥ ë†’ì€ ì„¹í„°

### Step 0.8: L2 ë¶„ë¦¬
- **í•¨ìˆ˜**: `classify_l2_by_rule()`
- **ë°©ì‹**: ê·œì¹™ ê¸°ë°˜
- **ì…ë ¥**: `major_sector`, `biz_summary`
- **ì¶œë ¥**: `sector_l2` ì½”ë“œ

### Step 4A: KF-DeBERTa Driver Signal Extraction
- **í•¨ìˆ˜**: `extract_driver_signals_from_sentences()`
- **ëª©ì **: ê°€ê²©/ìˆ˜ëŸ‰/ë¹„ìš© ë“œë¼ì´ë²„ ì‹œê·¸ë„ ì¶”ì¶œ
- **ì¶œë ¥**: `{price_signals, quantity_signals, cost_signals}`

### Step 4B: Gemini-Reasoning Industrial Graph
- **í•¨ìˆ˜**: `GeminiHandler.generate_causal_structure()`
- **ëª©ì **: ì¸ê³¼ êµ¬ì¡° ìƒì„± (ë¡œì»¬ LLM ëŒ€ì²´)
- **ì…ë ¥**: ì„¹í„°ë³„ ë“œë¼ì´ë²„ ì‹œê·¸ë„
- **ì¶œë ¥**: `causal_structure` JSON

### Step 4.5: Exposure Drivers ì¶”ì¶œ
- **í•¨ìˆ˜**: `extract_exposure_drivers()`
- **ëª©ì **: ë…¸ì¶œ ë“œë¼ì´ë²„ ì¶”ì¶œ
- **ì¶œë ¥**: `exposure_drivers` ë¦¬ìŠ¤íŠ¸

---

## ë°ì´í„° íë¦„

### ì…ë ¥ ë°ì´í„°
```python
{
    'ticker': str,              # ì¢…ëª©ì½”ë“œ
    'company_detail': CompanyDetail,  # íšŒì‚¬ ìƒì„¸ ì •ë³´
    'company_name': str,        # íšŒì‚¬ëª…
    'stock': Stock             # ì£¼ì‹ ì •ë³´
}
```

### ì¤‘ê°„ ë°ì´í„° êµ¬ì¡°
```python
{
    'major_sector': str,        # ì£¼ìš” ì„¹í„° (ì˜ˆ: 'SEC_SEMI')
    'sub_sector': str,          # í•˜ìœ„ ì„¹í„° (ì˜ˆ: 'MEMORY')
    'sector_l1': str,           # L1 ì„¹í„° ì½”ë“œ
    'sector_l2': str,           # L2 ì„¹í„° ì½”ë“œ
    'value_chain': str,         # ë°¸ë¥˜ì²´ì¸ (ì˜ˆ: 'MIDSTREAM')
    'weight': float,            # ì„¹í„° ê°€ì¤‘ì¹˜ (0.0-1.0)
    'is_primary': bool,         # Primary ì„¹í„° ì—¬ë¶€
    'confidence': str,          # Confidence ë ˆë²¨
    'method': str,              # ë¶„ë¥˜ ë°©ë²•
    'rule_score': float,        # Rule-based ì ìˆ˜
    'embedding_score': float,   # ì„ë² ë”© ì ìˆ˜
    'ensemble_score': float,   # ì•™ìƒë¸” ì ìˆ˜
    'reasoning': str,           # ë¶„ë¥˜ ê·¼ê±°
    'fallback_used': str,       # Fallback ì‚¬ìš© ì—¬ë¶€ ('TRUE'/'FALSE')
    'fallback_type': str,       # Fallback íƒ€ì… ('RULE'/'TOP1'/'KRX'/'UNKNOWN')
    'boosting_log': dict        # Boosting ë¡œê·¸
}
```

### ìµœì¢… ì¶œë ¥
```python
[
    {
        'major_sector': 'SEC_SEMI',
        'sub_sector': 'MEMORY',
        'sector_l1': 'SEC_SEMI',
        'sector_l2': 'MEMORY',
        'value_chain': 'MIDSTREAM',
        'weight': 0.6,
        'is_primary': True,
        'confidence': 'HIGH',
        'method': 'ENSEMBLE',
        'rule_score': 0.95,
        'embedding_score': 0.85,
        'ensemble_score': 0.88,
        'reasoning': '...',
        'fallback_used': 'FALSE',
        'fallback_type': None,
        'boosting_log': {...},
        'causal_structure': {...},
        'exposure_drivers': [...]
    },
    ...
]
```

---

## Fallback ë©”ì»¤ë‹ˆì¦˜

### Fallback ìˆœì„œ
1. **Rule-based Fallback**
   - ì¡°ê±´: í›„ë³´ ìƒì„± ì‹¤íŒ¨
   - íƒ€ì…: `'RULE'`
   - Confidence: `'MEDIUM'`

2. **Top-1 Candidate Fallback**
   - ì¡°ê±´: Rule-based ì‹¤íŒ¨, í›„ë³´ ìˆìŒ
   - íƒ€ì…: `'TOP1'`
   - Confidence: `'LOW'`

3. **KRX Fallback**
   - ì¡°ê±´: KRX ì—…ì¢… ì •ë³´ ìˆìŒ
   - íƒ€ì…: `'KRX'`
   - Confidence: `'VERY_LOW'`

4. **UNKNOWN Fallback**
   - ì¡°ê±´: ëª¨ë“  ë°©ë²• ì‹¤íŒ¨
   - íƒ€ì…: `'UNKNOWN'`
   - Confidence: `'VERY_LOW'`
   - ì„¹í„°: `'SEC_UNKNOWN'`

### Fallback ê°•ì œ ì²˜ë¦¬
- **ì¡°ê±´**: `sector_l1` ë˜ëŠ” `major_sector`ê°€ NULL
- **ì²˜ë¦¬**: `'SEC_UNKNOWN'` í• ë‹¹
- **ì„¤ì •**: `fallback_used='TRUE'`, `fallback_type='UNKNOWN'`

---

## Boosting ì‹œìŠ¤í…œ

### Anchor Boosting
- **ëª©ì **: Anchor ê¸°ì—…(ê³ ê°ì‚¬) ê¸°ë°˜ ê°€ì‚°ì  ë¶€ì—¬
- **ì „ëµ**: êµì§‘í•© ì „ëµ (í›„ë³´êµ°ì— í•´ë‹¹ ì„¹í„°ê°€ ìˆì„ ë•Œë§Œ)
- **Budget**: `MAX_TOTAL_BOOST = 0.05`
- **Gate ì¡°ê±´**:
  - ë²”ìš© ì„¹í„° ì™„ì „ ê¸ˆì§€
  - Role Gate ê°ì‡  (80%)
  - Top-2 gap < 0.03
  - Budget ì²´í¬

### KG Edge Boosting
- **ëª©ì **: Knowledge Graph Edge ê¸°ë°˜ ê°€ì‚°ì  ë¶€ì—¬
- **ì „ëµ**: ì•ˆì „í•œ Edge íƒ€ì…ë§Œ ì‚¬ìš©
- **Edge íƒ€ì…ë³„ ê°€ì¤‘ì¹˜ ì°¨ë“±**
- **Gate ì¡°ê±´**: Anchor Boostingê³¼ ë™ì¼

### Boosting ë¡œê·¸ êµ¬ì¡°
```python
{
    'anchor_applied': bool,
    'kg_applied': bool,
    'multiplier': float,      # Role Gate multiplier
    'final_boost': float,     # ìµœì¢… ì ìš©ëœ boost
    'reason': str            # ì ìš©/ë¯¸ì ìš© ì´ìœ 
}
```

---

## Confidence ë ˆë²¨

### ë ˆë²¨ ì •ì˜
- **HIGH**: `ensemble_score >= 0.7` ë˜ëŠ” `rule_score >= 0.9`
- **MEDIUM**: `0.5 <= ensemble_score < 0.7`
- **LOW**: `0.3 <= ensemble_score < 0.5`
- **VERY_LOW**: `ensemble_score < 0.3` ë˜ëŠ” Fallback

### Confidence ê²°ì • ë¡œì§
1. Rule-based HIGH â†’ ì¦‰ì‹œ HIGH ë°˜í™˜
2. Ensemble ì ìˆ˜ ê¸°ë°˜ ê²°ì •
3. Fallback ì‚¬ìš© ì‹œ â†’ VERY_LOW

---

## ê°€ì¤‘ì¹˜ ì‹œìŠ¤í…œ

### ê¸°ë³¸ ê°€ì¤‘ì¹˜
- **Rule-based**: 40%
- **Solar Embedding**: 50% (KF-DeBERTa + BGE-M3 í†µí•©)
- **GPT ê²€ì¦**: 10% (ì„ íƒì )

### ë™ì  ê°€ì¤‘ì¹˜ ì¡°ì •
- **GPT ë¹„í™œì„±í™” ì‹œ**: Rule 50%, Embedding 50%
- **Rule HIGH**: Rule ê°€ì¤‘ì¹˜ ì¦ê°€
- **ì„ë² ë”© ì‹ ë¢°ë„ ë†’ìŒ**: Embedding ê°€ì¤‘ì¹˜ ì¦ê°€

---

## ì£¼ìš” íŒŒì¼ êµ¬ì¡°

```
app/services/
â”œâ”€â”€ sector_classifier_ensemble.py      # Step 0-3.5 ê¸°ì¡´ Ensemble
â”œâ”€â”€ sector_classifier_ensemble_won.py  # Step 4A-4.5 Gemini-Reasoning
â”œâ”€â”€ sector_classifier.py              # Rule-based ë¶„ë¥˜ê¸°
â”œâ”€â”€ sector_classifier_embedding.py    # ì„ë² ë”© ëª¨ë¸ í›„ë³´ ìƒì„±
â”œâ”€â”€ sector_classifier_validator.py    # GPT ê²€ì¦
â”œâ”€â”€ gemini_handler.py                 # Gemini-Reasoning Handler
â”œâ”€â”€ sentence_signal_extractor.py      # KF-DeBERTa Driver Signal
â””â”€â”€ ...
```

---

## ì„±ëŠ¥ ì§€í‘œ

### í˜„ì¬ ìƒíƒœ
- **NULL ì„¹í„°**: 0ê°œ
- **ì„ë² ë”© ì»¤ë²„ë¦¬ì§€**: 100%
- **LOW confidence ë¹„ìœ¨**: 38.81%
- **Fallback ì‚¬ìš©ë¥ **: 0.1% (3ê°œ)
- **Boosting ì ìš©ë¥ **: 1,865ê°œ ê¸°ì—… (ë¡œê·¸ ì €ì¥)

---

**ì‘ì„±ì¼**: 2025-12-16
**ë²„ì „**: v1.0
